<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
    <meta charset="author" content="Sergio Mateos">
    <title>Tarea 1</title>
    <script>

        class Producto{

            #producto = {}; //Declaramos el objeto producto

            constructor(id,nombre,precio,imagen){
                this.#producto.id=id;
                this.#producto.nombre=nombre;
                this.#producto.precio=precio;
                this.#producto.imagen=imagen;

                return this.#producto;
            }
        }

        

        class Cesta{

            #arrayCesta=[];
            #productos;

            constructor(productos){
                this.#productos = productos;
                console.log(this.#productos)
                console.log(this.#arrayCesta)
            }

            #borrarItem(idElim){
                console.log("carga borrarItem()");
            }

            #filaItem(id,nombre,cantidad, precio){
                console.log("carga filaItem()");
            }

            #cargarCesta(arrayCesta){
                var cesta = document.getElementById("cesta")
                for (let i = 0; i < arrayCesta.length; i++) {
                    var fila = document.createElement("tr")
                    var columna = document.createElement("td")
                    columna.innerHTML = arrayCesta[i][0]
                    fila.appendChild(columna)

                    columna = document.createElement("td")
                    columna.innerHTML = arrayCesta[i][1]
                    fila.appendChild(columna)

                    columna = document.createElement("td")
                    columna.innerHTML = arrayCesta[i][2]
                    fila.appendChild(columna)

                    columna = document.createElement("td")
                    columna.innerHTML = arrayCesta[i][3]
                    fila.appendChild(columna)

                    columna = document.createElement("td")
                    columna.innerHTML = arrayCesta[i][2] * arrayCesta[i][3]
                    fila.appendChild(columna)

                    

                    var total = document.getElementById("total")
                    var totalIva = document.getElementById("totalIva")

                    cesta.appendChild(fila)
                   
                    var valor = 0
                    for (var info of arrayCesta) {
                        valor += (info[2] * info[3])
                    }
                    total.innerHTML = valor
                    totalIva.innerHTML = (valor*1.21)
                }
            }

            addCesta(id,nombre,cantidad,precio){
                
                this.#arrayCesta.push([id, nombre, this.cantidad, precio])
                var borrar = document.getElementById("cesta")
                borrar.innerText = "";
                this.#cargarCesta(this.#arrayCesta)
            }
            
        }

        class ContProductos{

            #productos = [];
            #cesta;
            
            constructor(productos){

                this.#introducirProductos(productos);
                this.#cesta = new Cesta(this.#productos);
                this.#cargarPorductos();

            }

            #introducirProductos(productos){

                for(var prod of productos){
                    this.#productos.push(new Producto(prod[0],prod[1],prod[2],prod[3]));
                }

            }


            #cargarPorductos(){

                let contenedorProductos = document.getElementById('contProductos');
                let contador = -1;

                for(let datos of this.#productos){
                    contador++;

                    let elemento = document.createElement('div');
                    elemento.classList.add('card', 'col-sm-4');

                    let elementoContenido = document.createElement('div');
                    elementoContenido.classList.add('card-body');

                    let elementoTitulo = document.createElement('h5');
                    elementoTitulo.classList.add('card-title');
                    elementoTitulo.innerText = datos.nombre;
                    
                    let elementoImagen = document.createElement('img');
                    elementoImagen.classList.add('img-fluid');
                    elementoImagen.setAttribute('src', datos.imagen);

                    let elementoPrecio = document.createElement('p');
                    elementoPrecio.classList.add('card-text');
                    elementoPrecio.innerText = datos.precio + '€';

                    let elementoUnidad = document.createElement('input');
                    elementoUnidad.setAttribute('data-idUni', datos.id);
                    elementoUnidad.setAttribute('type', 'number');
                    elementoUnidad.setAttribute('max', '999');
                    elementoUnidad.setAttribute('min', '1');
                    elementoUnidad.setAttribute('value', '1');
                    elementoUnidad.setAttribute('style', 'width:60px');

                    let elementoBoton = document.createElement('button');
                    elementoBoton.classList.add('btn', 'btn-primary');
                    elementoBoton.innerText = 'Añadir';
                    elementoUnidad.setAttribute('data-idBot',datos.id);

                    elementoBoton.addEventListener('click',this.#cesta.addCesta.bind(this.#cesta,datos.id,datos.nombre,2,datos.precio));
                    

                    elementoContenido.appendChild(elementoImagen);
                    elementoContenido.appendChild(elementoTitulo);
                    elementoContenido.appendChild(elementoPrecio);
                    elementoContenido.appendChild(elementoUnidad);
                    elementoContenido.appendChild(elementoBoton);
                    elemento.appendChild(elementoContenido);
                    contenedorProductos.appendChild(elemento);

                }

            }

        }

        var productos=[
            [1, "Bolso", 1120, "https://source.unsplash.com/random/500x500/?handbag"],
            [2, "Móvil", 58, "https://source.unsplash.com/random/500x500/?iphone"],
            [3, "Taza", 20, "https://source.unsplash.com/random/500x500/?cup"],
            [4, "Zapatos", 34, "https://source.unsplash.com/random/500x500/?shoes"],
            [5, "Vestido", 18, "https://source.unsplash.com/random/500x500/?dress"],
            [6, "Camara", 260, "https://source.unsplash.com/random/500x500/?camera"],
        ]

        window.onload=()=>new ContProductos(productos);

    </script>
</head>
<body>
    <hr>
    <div class="container">
        <nav class="navbar navbar-light" style="background-color: rgb(56, 56, 220); padding: 10px;">
            <h1><img src="https://lh5.ggpht.com/tq3WqEUxtRyBn-d_0t3j6WKNHuJDrmLq-FE3GAYrsAMQFIaS7FIgRLfzzql2SvfvLqto=w300" width="40" alt="" /> De todo ...</h1>
            <legend>Ejemplo cálculo de cesta o carrito de la compra ...</legend>
        </nav>
        <br>
        <div class="row">
            <div id="contProductos" class="col-sm-7 row"></div> <!-- ESTO VA A CONTNER LOS PRODUCTOS -->
            <div class="col-sm-5">
                <h2><img src="https://play-lh.googleusercontent.com/uTfWdvYEu-6F3eAqHg41n9rHb3RT0xGdLgMatvSAQbY1kOQr1I_axLJLmNFQ0XNOtH0r" width="50" height="50"></h2>
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th scope="col">Cod.</th>
                            <th scope="col">Nombre</th>
                            <th scope="col">Cantidad</th>
                            <th scope="col">Precio</th>
                            <th scope="col">Subtotal</th>
                        </tr>
                    </thead>
                    <tbody id="cesta"></tbody>
                </table>
                <hr>
                <p class="text-right">Total: <span id="total"></span>&nbsp;&euro;</p>
                <p class="text-right">Total + IVA (21%):<strong><span id="totalIva"></span></strong></p>
            </div>
        </div>
    </div>
</body>
</html>